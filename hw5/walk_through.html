

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Setup and Walk-through &#8212; ESE5320 Handouts Fall 2024</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'hw5/walk_through';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Homework Submission" href="homework_submission.html" />
    <link rel="prev" title="Collaboration" href="collaboration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/penn_engineering.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/penn_engineering.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Overview
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://www.seas.upenn.edu/~ese5320/fall2024/fall2024.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writeup_guidelines.html">Writeup Guidelines</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Homework Assignments</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw0/index.html">Diagnostic Assessment</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw0/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw0/questions.html">Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw0/homework_submission.html">Homework Submission</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw1/index.html">HW1 – Remember C</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw1/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/walk_through.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/makefile_tutorial.html">Makefile Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/gdb_tutorial.html">GDB Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/c_refresher.html">C Refresher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/debug_app.html">Debug an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/homework_submission.html">Homework Submission</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw2/index.html">HW2 – Profiling</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw2/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw2/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw2/homework_submission.html">Homework Submission</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw3/index.html">HW3 – Thread Parallel</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw3/collaboration.html">Collaboration</a></li>

<li class="toctree-l2"><a class="reference internal" href="../hw3/u96v2_setup.html">Ultra96 Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw3/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw3/homework_submission.html">Homework Submission</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw4/index.html">HW4 – SIMD</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw4/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw4/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw4/homework_submission.html">Homework Submission</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">HW5 – Accelerator</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="collaboration.html">Collaboration</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="homework_submission.html">Homework Submission</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/icgrp/ese532_handouts" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/icgrp/ese532_handouts/edit/master/ese532_handouts/hw5/walk_through.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/icgrp/ese532_handouts/issues/new?title=Issue%20on%20page%20%2Fhw5/walk_through.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/hw5/walk_through.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Setup and Walk-through</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hardware-acceleration">Hardware Acceleration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-vitis-2020-2-on-your-personal-computer-linux-os">Installing Vitis 2020.2 on your Personal Computer(Linux OS)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-and-running-the-code">Obtaining and Running the Code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-code">Building the code</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-ultra96-and-host-computer">Setting up Ultra96 and Host Computer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-on-the-fpga">Run on the FPGA</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#write-the-sd-card-image-one-time-setup">Write the SD Card Image (one time setup)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boot-the-ultra96">Boot the Ultra96</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reference">Reference</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="setup-and-walk-through">
<h1>Setup and Walk-through<a class="headerlink" href="#setup-and-walk-through" title="Permalink to this heading">#</a></h1>
<!-- ```{include} ../common/aws_caution.md
``` -->
<style type="text/css">
    table { width: 100%; }
    th { background-color: #4CAF50;color: white;height:50px;text-align: center; }
    td {height:50px;text-align: center;}
    tr:nth-child(even) {background-color: #f2f2f2;}
</style>
<section id="hardware-acceleration">
<h2>Hardware Acceleration<a class="headerlink" href="#hardware-acceleration" title="Permalink to this heading">#</a></h2>
<p>To implement a hardware function, it will ultimately be necessary
to perform low-level placement and routing of the hardware onto the
FPGA substrate.  That is, the tools must decide which particular instance of
each primitive is used (placement) or which wires to use for connections
(routing).  These tasks are typically much slower (at least 20 minutes, can take
hours) than the compilation time for software (a few minutes).  This means you
will need to plan your time carefully for this lab and for subsequent labs.
One way to optimize our development time is to be careful about when we
invoke low-level placement and routing and when we can avoid it.   This lab
and next will show you a few techniques that allow you to reduce the number of
times you need to invoke low-level placement and routing and introduce
simulation and emulation you can use validate your design before
invoking low-level placement and routing.</p>
<p>In the homework, you could either use linux machines in Detkin/Ketterer or
install Vitis locally. If you want to install Vitis locally, we expect that your computer has at least:</p>
<ul class="simple">
<li><p>Linux OS</p></li>
<li><p>16 GB RAM</p></li>
<li><p>4 cores</p></li>
<li><p>70 GB free hard disk space
If you want to install Vitis locally, follow the instructions in
<a class="reference internal" href="#install-locally"><span class="std std-ref">Installing Vitis 2020.2 on your Personal Computer(Linux OS)</span></a>. If you want to use Detkin/Ketterer machines,
jump to <a class="reference internal" href="#software-code"><span class="std std-ref">Obtaining and Running the Code</span></a>.</p></li>
</ul>
<section id="installing-vitis-2020-2-on-your-personal-computer-linux-os">
<span id="install-locally"></span><h3>Installing Vitis 2020.2 on your Personal Computer(Linux OS)<a class="headerlink" href="#installing-vitis-2020-2-on-your-personal-computer-linux-os" title="Permalink to this heading">#</a></h3>
<!-- Running Vitis on your local computer will likely be the best interactive
experience with the GUI.  However, it will take more time and effort (and
disk space) to get it setup.  Ultimately, we recommend you set it up, but
the other two options means that getting it setup on your local computer
does not need to be in your critical path to starting to use the Ultra96. -->
<!-- Note that Vitis only supports Windows and Linux. Although
you can use Windows, we strongly suggest you install linux,
since we developed our homework code on Linux (Ubuntu 20.04). 
We won't be able to
help you if you encounter unexpected bugs and issues with tools
that may arise from using a different OS. For MacOS users,
you have no choice other than installing Vitis in a Virtual Machine. Following are two tutorials we have on setting up
a virtual machine. Use Ubuntu 20.04 and the use the instructions
below to install Vitis (the tutorials install SDSoC and you should not install that) on your virtual machine:
- [ESE532 SDSoC on Parallels Desktop](https://youtu.be/HaOWfmCAyCE)
- [ESE532 SDSoC on Virtual Box](https://docs.google.com/document/d/1XKVsD3gt8NeJgvcykNxD37CZME8r-dkUBl1D8KESYZk/edit?usp=sharing) -->
<p>Note that Vitis is fully supported in Linux OS only.
Follow the instructions below to install Vitis on your linux machine:</p>
<ol class="arabic">
<li><p>Go to <a class="reference external" href="https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/vivado-design-tools/archive.html">this link</a> and
select <em><strong>2020.2</strong></em>. Then, download
<em><strong>Xilinx Unified Installer 2020.2: Linux Self Extracting Web Installer</strong></em>. Create an account with Xilinx if you don’t have one.</p></li>
<li><p>We found <a class="reference external" href="https://youtu.be/debP5oI28l8">this video</a> useful to install Vitis.</p></li>
<li><p>When selecting devices, selecting Zynq UltraScale+ MPSoC should be enough for this class.</p>
<figure class="align-default" id="ese5320-vitis-devices">
<img alt="../_images/ese5320_vitis_devices.png" src="../_images/ese5320_vitis_devices.png" />
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Selecting devices when installing Vitis</span><a class="headerlink" href="#ese5320-vitis-devices" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The full installation will take about 30 min - 1 hour.</p>
</li>
<li><p>Open the file <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> in your terminal and add the following line. This is the license for using Vitis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">LM_LICENSE_FILE</span><span class="o">=</span><span class="s2">&quot;2100@potato.cis.upenn.edu:1709@potato.cis.upenn.edu:1717@potato.cis.upenn.edu:27010@potato.cis.upenn.edu:27009@potato.cis.upenn.edu&quot;</span>
</pre></div>
</div>
<p>Do <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">~/.bashrc</span></code> to update the terminal environment
with this variable.</p>
</li>
<li><p>You might need to issue the following commands if you encounter an error with <code class="docutils literal notranslate"><span class="pre">libtinfo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">libtinfo</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libtinfo</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libtinfo</span><span class="o">.</span><span class="n">so</span><span class="mf">.5</span>
</pre></div>
</div>
</li>
<li><p>As of January 1st 2022, there needs a patch. Download <em><strong>y2k22_patch-1.2.zip</strong></em> in <a class="reference external" href="https://support.xilinx.com/s/article/76960?language=en_US">this link</a>.
Follow the instructions to apply y2k22 patch. If need help on this, please contact TAs.</p></li>
<li><p>Get the Ultra96 platform from <a class="reference external" href="https://www.avnet.com/wps/portal/us/products/avnet-boards/avnet-board-families/ultra96-v2/">here</a>.
Scroll down and click <strong>Reference Designs</strong> tab. Then, click <strong>Ultra96-V2 – Vitis Platform 2020+ (Sharepoint site)</strong>.
Click <strong>2020.2</strong><span class="math notranslate nohighlight">\(\rightarrow\)</span><strong>Vitis_Platform</strong>. Download <strong>u96v2_sbc_vitis_2020_2.tar.gz</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xvzf</span> <span class="n">u96v2_sbc_vitis_2020_2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Locate the extracted folder to wherever you want.</p>
</li>
</ol>
</section>
<section id="obtaining-and-running-the-code">
<span id="software-code"></span><h3>Obtaining and Running the Code<a class="headerlink" href="#obtaining-and-running-the-code" title="Permalink to this heading">#</a></h3>
<p>In this homework, we will first run a matrix multiplication function on the cpu and then run the same matrix multiplication
function on the FPGA.</p>
<p>Pull in the latest changes using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">ese532_code</span><span class="o">/</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
<p>The code you will use for <a class="reference internal" href="homework_submission.html"><span class="doc std std-doc">homework submission</span></a>
is in the <code class="docutils literal notranslate"><span class="pre">hw5</span></code> directory. The directory structure looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hw5</span><span class="o">/</span>
    <span class="n">sourceMe</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">xrt</span><span class="o">.</span><span class="n">ini</span>
    <span class="n">common</span><span class="o">/</span>
        <span class="n">Constants</span><span class="o">.</span><span class="n">h</span>
        <span class="n">EventTimer</span><span class="o">.</span><span class="n">h</span>
        <span class="n">EventTimer</span><span class="o">.</span><span class="n">cpp</span>
        <span class="n">Utilities</span><span class="o">.</span><span class="n">cpp</span>
        <span class="n">Utilities</span><span class="o">.</span><span class="n">h</span>
    <span class="n">hls</span><span class="o">/</span>
        <span class="n">MatrixMultiplication</span><span class="o">.</span><span class="n">h</span>
        <span class="n">MatrixMultiplication</span><span class="o">.</span><span class="n">cpp</span>
        <span class="n">Testbench</span><span class="o">.</span><span class="n">cpp</span>
    <span class="n">Host</span><span class="o">.</span><span class="n">cpp</span>
    <span class="n">Makefile</span>
    <span class="n">u96_v2</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sourceMe.sh</span></code> will help you to source Xilinx tools</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xrt.ini</span></code> defines the options necessary for Vitis Analyzer.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">common</span></code> folder has header files and helper functions.</p></li>
<li><p>You will mostly be working with the code in the <code class="docutils literal notranslate"><span class="pre">hls</span></code> folder. The
<code class="docutils literal notranslate"><span class="pre">hls/MatrixMultiplication.cpp</span></code> file has the function that gets compiled
to a hardware function (known as a kernel in Vitis). The <code class="docutils literal notranslate"><span class="pre">Host.cpp</span></code> file has
the “driver” code that transfers the data to the fpga, runs the kernel,
fetches back the result from the kernel and then verifies it for correctness.</p></li>
<li><p>Read <a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/2022.1/Getting_Started/Vitis">this tutorial</a> to get an idea of how the Vitis flow works.
Note that there are <em>Data Center Platform</em> and <em>Embedded Platform</em>. Our ultra96 board belongs to <em>Embedded Platform</em>.</p></li>
</ul>
<!-- - Read [this](https://developer.xilinx.com/en/articles/example-1-simple-memory-allocation.html) to learn about simple memory allocation and OpenCL execution. -->
<!-- - Read [this](https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis/Part3.md#the-source-code-for-the-vector-add-kernel) to learn about the syntax of the code in `hls/MatrixMultiplication.cpp`.
- Read [this](https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis/Part3.md#the-source-code-for-the-host-program) to learn about how the hardware function is
utilized in `Host.cpp` -->
<!-- - Read [this](https://developer.xilinx.com/en/articles/example-3-aligned-memory-allocation-with-opencl.html) to learn about aligned memory allocation with OpenCL. -->
<!-- - Run the matrix multiplication on the cpu by doing:
    ```
    # compile
    source $AWS_FPGA_REPO_DIR/vitis_setup.sh
    export PLATFORM_REPO_PATHS=$(dirname $AWS_PLATFORM)
    make all TARGET=sw_emu

    # run
    source $AWS_FPGA_REPO_DIR/vitis_runtime_setup.sh
    export XCL_EMULATION_MODE=sw_emu
    ./host mmult.xclbin
    ```
- We will now use Vitis Analyzer to view the trace of our matrix multiplication on cpu
    and find out how long each API call took.
    1. Read about how to use Vitis Analyzer from [here](https://github.com/Xilinx/Vitis-Tutorials/blob/master/Getting_Started/Vitis/Part5.md).
<!--     1. Open a remote desktop session on your `z1d.2xlarge` instance. -->
<!--     1. Run `vitis_analyzer ./xclbin.run_summary` to open Vitis Analyzer and try to associate the api calls with the code in `Host.cpp`.
    1. Hover over an API call to find out long it took.
 -->
<p>We are now going to start working on the <a class="reference internal" href="homework_submission.html"><span class="doc">Homework Submission</span></a> where we will follow a bottom-up approach and optimize
our hardware function using Vitis HLS IDE first and then re-compile it and run it on the FPGA in the end. <!-- Scroll to {ref}`vitis_hls` to learn about how to use Vitis HLS. -->
<a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/2022.1/Getting_Started/Vitis_HLS">This tutorial</a> will give you a basic idea on Vitis HLS.</p>
<p>Once you have 3i completed from the <a class="reference internal" href="homework_submission.html"><span class="doc">Homework Submission</span></a>,
proceed <a class="reference internal" href="#vitis"><span class="std std-ref">Building the code</span></a>.</p>
<hr class="docutils" />
<!-- (vitis_hls)=
### Using Vitis HLS
Creating a new project in Vitis HLS is explained [here](https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis_HLS/new_project.md#1-creating-a-vitis-hls-project).
Make sure you enter the top-level function during the creation of the
project (although you can also change it later). The top-level function is
the function that will be called by the part of your application that runs
in software.  Vitis HLS needs it for synthesis.  You can also indicate
which files you want to create.  It is wise to add a testbench file too,
while you are creating the project.

We have provided a testbench in Vitis HLS to debug the hardware.
The requirements for testbenches are not any different from other
software applications written in C.  Similar to them, testbenches
have a `main` function that is invoked.  To the main function you can
add any functionality needed to test your function.  That includes calling
the top function that you would like to test.  When the testbench is
satisfied that the function is correct, it should return 0.  Otherwise, it
should return another value.

You can run the testbench by selecting ***Project*** $\rightarrow$ ***Run C Simulation*** from the menu.  A window should pop up.  The default settings of the dialog
should be fine.  You can dismiss the dialog by pressing ***OK***.  You
can see in the ***Console*** whether your test has passed.  If your test
fails, you can run the test in debug mode.  This can be done by repeating
the same procedure, except that you should check the box in front of
***Launch Debugger*** this time before you dismiss the dialog.  This
will take you to the ***Debug*** perspective, where you can set breakpoints and use the step into/step over buttons to debug.  You can go back to the original perspective by pressing the ***Synthesis*** button in the top, right corner.  

To rebuild the code, you should go back to Synthesis mode, and click ***Run C Simulation*** again to rebuild the code.

Once you are satisfied with your code, you can run ***Solution***
$\rightarrow$ ***Run C Synthesis*** $\rightarrow$ ***Active Solution*** from the menu
to synthesize your design.  You can also verify the synthesized version of
your accelerator in your testbench.  If you choose to do so, Vitis HLS
will run your accelerator in a simulator, so this method is called C/RTL
Cosimulation.  The employed cycle-level simulation is much slower than
realtime execution, so this method may not be
practical for every testbench.  It avoids needing to run low
level-placement and routing and will give you more visibility into the
behavior of your design.  Anyway, you can start it by choosing
***Solution*** $\rightarrow$ ***Run C/RTL Cosimulation*** from the menu.

The hardware implementation that Vitis HLS selects can be controlled
by including pragmas, e.g. `#pragma HLS inline`, in your code.
The different pragmas that you can use in your functions are listed in [Vitis HLS User Guide](https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/HLS-Pragmas).

When you have obtained a satisfying hardware description in Vitis HLS, you will [Export Vitis Kernel](https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis_HLS/dataflow_design.md#export-the-vitis-kernel), i.e. a Xilinx object file (.xo).
 -->
<!-- We will then [use this object file/kernel](https://github.com/Xilinx/Vitis-In-Depth-Tutorial/blob/master/Getting_Started/Vitis_HLS/using_the_kernel.md) and link it together in our existing Vitis application. -->
<!-- ```{note}
We are using the GUI mode of Vitis HLS so that we can see the HLS schedule.
In this class, our preferred method of compiling is using the command line
and we'll only use GUI when it's required.

If your remote desktop connection is lagging, you can run Vitis HLS
from the command line using the script, `export_hls_kernel.sh`, 
in the `hw5/hls` directory. This script runs the TCL script, `run_hls.tcl`, 
with Vitis HLS. Vitis HLS GUI actually calls the commands in this TCL script.
If you look inside the TCL script, you can relate it to the GUI steps
we mentioned above. Additionally, you can learn more about the TCL commands
from:
- <https://www.xilinx.com/html_docs/xilinx2020_1/vitis_doc/tre1585063528538.html>
- <https://www.xilinx.com/html_docs/xilinx2020_1/vitis_doc/nfj1539734250759.html>

Note that the only way to see the HLS schedule is through the GUI.
So collaborate with your partner if you are unable to use the GUI in AWS or try
to [install Vitis toolchain locally](https://github.com/Xilinx/Vitis-In-Depth-Tutorial/blob/master/Getting_Started/Vitis/Part2.md#vitis-flow-101--part-2--installation-guide).
``` -->
</section>
<section id="building-the-code">
<span id="vitis"></span><h3>Building the code<a class="headerlink" href="#building-the-code" title="Permalink to this heading">#</a></h3>
<p>Make sure you have 3i completed from the <a class="reference internal" href="homework_submission.html"><span class="doc">Homework Submission</span></a>.
Vitis flow consists of <strong>1)compiling the host code, 2)generating kernel object(.xo file), 3)generating FPGA binary(.xclbin file), 4)packaging to a bootable image.</strong>
If you take a look at the Makefile, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> will execute steps specified above.</p>
<p>Because we already generated <code class="docutils literal notranslate"><span class="pre">mmult.xo</span></code> file, the command to generate Xilinx object file(<code class="docutils literal notranslate"><span class="pre">.xo</span></code>) is commented out.
Vitis compiler(<code class="docutils literal notranslate"><span class="pre">v++</span></code>) performs this step with <code class="docutils literal notranslate"><span class="pre">--compile</span></code> flag, or <code class="docutils literal notranslate"><span class="pre">-c</span></code> for short.
You can also generate <code class="docutils literal notranslate"><span class="pre">.xo</span></code> file directly using Vitis HLS like we just did.
FYI, you can create <code class="docutils literal notranslate"><span class="pre">.xo</span></code> file from RTL code, too (obviously).</p>
<p>Next step, which is usually called “linking” step, calls Vivado to perform
logic synthesis, placement, and routing to generate a FPGA binary container file(<code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>, Yes, this file encapsulates the bitstream that’s necessary to program the FPGA).
Vitis compiler(<code class="docutils literal notranslate"><span class="pre">v++</span></code>) performs this step with <code class="docutils literal notranslate"><span class="pre">--link</span></code>, or <code class="docutils literal notranslate"><span class="pre">-l</span></code> for short.
This step is the most time-consuming part in FPGA development on Vitis, and for this lab, it should take &gt;20 minutes.</p>
<p>The last step is called “packaging” step and is done with <code class="docutils literal notranslate"><span class="pre">--package</span></code>, or <code class="docutils literal notranslate"><span class="pre">-p</span></code> for short.
This step packages your design and define various files required for booting/configuring the device.</p>
<ul>
<li><p>Make sure that <code class="docutils literal notranslate"><span class="pre">mmult.xo</span></code> exists in HW5 directory.</p></li>
<li><p>Source settings to be able to run vitis:
<code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">sourceMe.sh</span></code>.</p>
<p><strong>If you work locally</strong>, source <code class="docutils literal notranslate"><span class="pre">settings64.sh</span></code> in vitis
installation directory and do <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PLATFORM_REPO_PATHS=/PATH/TO/U96_V2_PLATFORM</span></code>.</p>
<p>(e.g. <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PLATFORM_REPO_PATHS=/home/user/ese5320/u96v2_sbc_base</span></code>)</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> to generate .xclbin file and bootable image.
This process will take &gt;20 minutes depending on your kernel design.
If you are working in Detkin/Ketterer, make sure that you have enough space in your user directory so that the image file does not exceed the quota.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <code class="docutils literal notranslate"><span class="pre">u96_v2.cfg</span></code>, we commented out the profiling block.
As mentioned in <a class="reference external" href="https://docs.xilinx.com/r/2020.2-English/ug1393-vitis-application-acceleration/profile-Options">here</a>,
we can monitor data ports with Vitis Analyzer when the profiling is enabled. But it costs additional resources on the FPGA that makes
the compilation longer, and we commented out for this assignment.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To increase the clock frequency, you first need to generate <code class="docutils literal notranslate"><span class="pre">.xo</span></code> file targeting 200MHz(for example) in Vitis HLS.
And you need to include a flag like <code class="docutils literal notranslate"><span class="pre">--clock.defaultFreqHz</span> <span class="pre">200000000</span></code> when you do linking (<code class="docutils literal notranslate"><span class="pre">v++</span> <span class="pre">--link</span></code>).
Without the flag, the tool uses the default clock frequency for Ultra96, which is 150MHz.</p>
<p>If you go through <a class="reference external" href="https://docs.xilinx.com/r/2020.2-English/ug1393-vitis-application-acceleration/Getting-Started-with-Vitis">Vitis User Guide</a>
for useful flags/options, please make sure that they are applicable to the embedded platform.
As mentioned earlier, there are datacenter platform and embedded platform; Ultra96 belongs to the embedded platform.</p>
</div>
</li>
</ul>
</section>
</section>
<section id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this heading">#</a></h2>
<section id="setting-up-ultra96-and-host-computer">
<h3>Setting up Ultra96 and Host Computer<a class="headerlink" href="#setting-up-ultra96-and-host-computer" title="Permalink to this heading">#</a></h3>
<!-- We have provided you with:
- An Ultra96 board with a power cable and a JTAG USB cable
- 2 USB-ethernet adapters
- 1 ethernet cable
- 1 SD card and an SD card reader
- USB-C to USB 3.1 adaptor (for those of you who only have USB-C ports in your computer) -->
<!-- We expect you have a personal computer. If you intend to install
Vitis locally, we expect that your computer has at least:
- 16 GB RAM
- 4 cores
- 70 GB free hard disk space

Otherwise, our suggestion is that you compile your code either
on AWS or Biglab (shown later) and then later copy the binaries
to your personal computer, copy them into the board and finally run them on the board.
 -->
<!-- In the end,  -->
<p>Your setup should look like <a class="reference internal" href="#ultra96-setup-hw5"><span class="std std-numref">Fig. 18</span></a> like we did in HW3 and HW4.</p>
<!-- You can also use Windows PCs in Detkin/Ketterer. -->
<figure class="align-default" id="ultra96-setup-hw5">
<a class="reference internal image-reference" href="../_images/env_setup1.jpg"><img alt="../_images/env_setup1.jpg" src="../_images/env_setup1.jpg" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Development Environment</span><a class="headerlink" href="#ultra96-setup-hw5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="run-on-the-fpga">
<h3>Run on the FPGA<a class="headerlink" href="#run-on-the-fpga" title="Permalink to this heading">#</a></h3>
<section id="write-the-sd-card-image-one-time-setup">
<h4>Write the SD Card Image (one time setup)<a class="headerlink" href="#write-the-sd-card-image-one-time-setup" title="Permalink to this heading">#</a></h4>
<p>Once the build has completed in <a class="reference internal" href="#vitis"><span class="std std-ref">Building the code</span></a> section, you will see a generated <code class="docutils literal notranslate"><span class="pre">package</span></code> directory. e.g. <code class="docutils literal notranslate"><span class="pre">hw5/package</span></code>.
The package directory contains the following
files that we are interested in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">.</span><span class="n">img</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">BOOT</span><span class="o">.</span><span class="n">BIN</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">boot</span><span class="o">.</span><span class="n">scr</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">host</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>If you are working in Detkin/Ketterer machines, we suggest you to copy files above to your
local machine and proceed. You can plug in USB disk to the Detkin/Ketterer machines and copy the
generated <code class="docutils literal notranslate"><span class="pre">package</span></code> directory over to your laptop. You can also use <code class="docutils literal notranslate"><span class="pre">scp</span></code> or WinSCP.</p>
<!-- If your laptop is Linux, you can use `scp` and if you are using
Windows you can use programs like [WinSCP](https://winscp.net/eng/index.php).
When you are building for the first time, we will write the
`package/sd_card.img` image to our SD card. -->
<ul class="simple">
<li><p>If another image is already written on your SD card(from HW3/HW4), delete the partitions.
On Linux, you can do this from <em>Disks</em> application.</p></li>
<li><p>Write <code class="docutils literal notranslate"><span class="pre">sd_card.img</span></code> to your SD card.</p>
<ul>
<li><p>In Ubuntu 20.04, you can use <code class="docutils literal notranslate"><span class="pre">Startup</span> <span class="pre">Disk</span> <span class="pre">Creator</span></code>.</p></li>
<li><p>You can also use <a class="reference external" href="https://rufus.ie/">Rufus</a> or
<a class="reference external" href="https://www.balena.io/etcher/">balenaEtcher</a>.</p></li>
</ul>
</li>
<li><p>Once you finish writing the image to the SD card, slide it into your Ultra96’s SD card slot.</p></li>
</ul>
<!-- - First put your SD card into the SD card reader and plug it to your computer.
- In Ubuntu 20.04, you can use `Startup Disk Creator`.
- You can also use [Rufus](https://rufus.ie/) or
      [balenaEtcher](https://www.balena.io/etcher/).
- After it's done, you can verify that there are two partitions in the SD card now:
    - the first partition has the files we mentioned above. These are the files that will change every time we build our code.
    - the second partition contains the Linux rootfs. This will not change. -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will only have to write our SD card image <strong>once</strong>.
When we recompile our code, the files that will need to be
updated are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">BOOT</span><span class="o">.</span><span class="n">BIN</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">boot</span><span class="o">.</span><span class="n">scr</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">host</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>We will copy those files to the running board using <code class="docutils literal notranslate"><span class="pre">scp</span></code>.
We will then reboot the board, which will load the updated
boot files. The boot files contain the bitstream, which
reconfigures the <strong>Programmable Logic</strong> of the Ultra96. Hence,
we need a reboot. If you copy the files, but don’t do a reboot,
you will see that your program throws an error.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your Ultra96 is connected to a different machine from the one where
you are running Vitis (e.g., you are running Vitis on a Detkin machine,
but your Ultra96 is connected to your laptop), you will need to first
copy the files from the Vitis machine(Detkin machine) to the Ultra96-host machine(your laptop) and
then copy them from the Ultra96-host(your laptop) to the Ultra96.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Make sure you don’t hot plug/unplug the SD card. This can potentially corrupt the SD card/damage the board. Always shut down the device first and then insert/take out the SD card. You can shut down the device by typing “poweroff” in the serial console of the device.</p>
</div>
</section>
<section id="boot-the-ultra96">
<h4>Boot the Ultra96<a class="headerlink" href="#boot-the-ultra96" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Boot the ultra96 as we did in HW3 and HW4. Login as <code class="docutils literal notranslate"><span class="pre">root</span></code> with Password: <code class="docutils literal notranslate"><span class="pre">root</span></code>.</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If you have trouble with ssh to the board after flashing the new SD card img, it might because the SSH key on the board has changed but your host computer still remembers the old one. To resolve this issue, you can manually remove the old SSH key from your host computer’s known_hosts file.</p>
<p>Use a file editor (nano/vim/vscode/notepad) to open the known_hosts file:</p>
<p>code ~/.ssh/known_hosts</p>
<p>Find the line associated with the old IP address of the board, delete it, and save the file.</p>
</div>
<ul>
<li><p>On the serial console, you can now run your code as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span>
<span class="n">export</span> <span class="n">XILINX_XRT</span><span class="o">=/</span><span class="n">usr</span>
<span class="o">./</span><span class="n">host</span> <span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>You should see the log message that the xclbin file is being loaded.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Loading</span><span class="p">:</span> <span class="s1">&#39;mmult.xclbin&#39;</span>
</pre></div>
</div>
<p>In the last line of the log message, you should see the testing message.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span> <span class="n">PASSED</span>
</pre></div>
</div>
</li>
<li><p>You should see the generated files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span><span class="o">.</span><span class="n">run_summary</span>
<span class="n">profile_summary</span><span class="o">.</span><span class="n">csv</span>
<span class="n">timeline_trace</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>To generate these files, you need to have <code class="docutils literal notranslate"><span class="pre">xrt.ini</span></code> in the same directory that you run <code class="docutils literal notranslate"><span class="pre">./host</span> <span class="pre">mmult.xclbin</span></code> on.
If you uncomment the profiling block in <code class="docutils literal notranslate"><span class="pre">u96_v2.cfg</span></code> when you build for <code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>, you will be able to get additional information in these <code class="docutils literal notranslate"><span class="pre">*.csv</span></code> files.</p>
</li>
<li><p>Copy these files to your computer by issuing the following command. Modify the command with the username of your computer and
the directory you want to put the files in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span><span class="o">.</span><span class="n">run_summary</span> <span class="n">timeline_trace</span><span class="o">.</span><span class="n">csv</span> <span class="n">profile_summary</span><span class="o">.</span><span class="n">csv</span> <span class="n">YOURNAME</span><span class="o">@</span><span class="mf">10.10.7.2</span><span class="p">:</span><span class="o">/</span><span class="n">YOUR_DIR</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>If you are using Detkin/Ketterer machines, copy these files to Detkin/Ketterer machines and run
Vitis Analayzer in your host computer to view the trace by doing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="o">./</span><span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span><span class="o">.</span><span class="n">run_summary</span>
</pre></div>
</div>
</li>
<li><p>As stated in the note above, when you modify your HLS code, that will cause the hardware to
change, and hence the following files(regenerated) will need to be copied to
the <code class="docutils literal notranslate"><span class="pre">/media/sd-mmcblk0p1</span></code> directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">BOOT</span><span class="o">.</span><span class="n">BIN</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">boot</span><span class="o">.</span><span class="n">scr</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">host</span>
<span class="n">package</span><span class="o">/</span><span class="n">sd_card</span><span class="o">/</span><span class="n">mmult</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>After you copy these files, type <code class="docutils literal notranslate"><span class="pre">reboot</span></code> in the serial
console and that will reprogram the device.</p>
</li>
<li><p>When you only modify your host code, you don’t have to copy any of the files mentioned above and only neeed to copy the
OpenCL host binary, which is <code class="docutils literal notranslate"><span class="pre">host</span></code> in this example. You also don’t need to reboot the device in that case.</p></li>
</ul>
<p>This concludes a top-down walk-through of the steps involved
in running a hardware function on the Ultra96.</p>
</section>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this heading">#</a></h2>
<!-- - <https://github.com/Xilinx/Vitis-AWS-F1-Developer-Labs/blob/master/setup/instructions.md>
- <https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html>
- <https://www.ni-sp.com/setting-up-access-to-the-nice-dcv-license-in-ec2/>
- <https://github.com/aws/aws-fpga/blob/master/Vitis/docs/Setup_AWS_CLI_and_S3_Bucket.md>
 -->
<ul class="simple">
<li><p><a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration">https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration</a></p></li>
<li><p><a class="github reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/2022.1/Getting_Started/Vitis">Xilinx/Vitis-Tutorials</a></p></li>
<li><p><a class="github reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/2022.1/Getting_Started/Vitis_HLS">Xilinx/Vitis-Tutorials</a></p></li>
</ul>
<!-- - <https://github.com/Xilinx/Vitis-Tutorials/blob/master/docs/Pathway3/BuildingAnApplication.md>
 -->
 <!-- - <https://github.com/aws/aws-fpga/blob/master/Vitis/README.md>
 -->
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./hw5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="collaboration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Collaboration</p>
      </div>
    </a>
    <a class="right-next"
       href="homework_submission.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Homework Submission</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hardware-acceleration">Hardware Acceleration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-vitis-2020-2-on-your-personal-computer-linux-os">Installing Vitis 2020.2 on your Personal Computer(Linux OS)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-and-running-the-code">Obtaining and Running the Code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-code">Building the code</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-ultra96-and-host-computer">Setting up Ultra96 and Host Computer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-on-the-fpga">Run on the FPGA</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#write-the-sd-card-image-one-time-setup">Write the SD Card Image (one time setup)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boot-the-ultra96">Boot the Ultra96</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reference">Reference</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Department of Electrical and Systems Engineering
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024 Department of Electrical and Systems Engineering at the University of Pennsylvania.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>