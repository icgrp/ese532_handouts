
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Homework Submission &#8212; ESE5320 Handouts Fall 2022</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HW6 – Accelerator Interface" href="../hw6/index.html" />
    <link rel="prev" title="Setup and Walk-through" href="walk_through.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/penn_engineering.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ESE5320 Handouts Fall 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Overview
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://www.seas.upenn.edu/~ese5320/fall2022/fall2022.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../writeup_guidelines.html">
   Writeup Guidelines
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Homework Assignments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw0/index.html">
   Diagnostic Assessment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw0/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw0/questions.html">
     Questions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw0/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw1/index.html">
   HW1 – Remember C
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/walk_through.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/makefile_tutorial.html">
     Makefile Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/gdb_tutorial.html">
     GDB Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/c_refresher.html">
     C Refresher
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/debug_app.html">
     Debug an Application
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw1/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw2/index.html">
   HW2 – Profiling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw2/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw2/walk_through.html">
     Setup and Walk-through
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw2/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw3/index.html">
   HW3 – Thread Parallel
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw3/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw3/u96v2_setup.html">
     Ultra96 Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw3/walk_through.html">
     Setup and Walk-through
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw3/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw4/index.html">
   HW4 – SIMD
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw4/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw4/walk_through.html">
     Setup and Walk-through
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw4/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   HW5 – Accelerator
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="walk_through.html">
     Setup and Walk-through
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw6/index.html">
   HW6 – Accelerator Interface
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw6/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw6/walk_through.html">
     Setup and Walk-through
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw6/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hw7/index.html">
   HW7 – Restructuring C for Accelerator and Zynq Transition
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw7/collaboration.html">
     Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw7/walk_through.html">
     Setup and Walk-through
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hw7/homework_submission.html">
     Homework Submission
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/icgrp/ese532_handouts"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/icgrp/ese532_handouts/issues/new?title=Issue%20on%20page%20%2Fhw5/homework_submission.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/icgrp/ese532_handouts/edit/master/ese532_handouts/hw5/homework_submission.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/hw5/homework_submission.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deliverables">
   Deliverables
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Homework Submission</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deliverables">
   Deliverables
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="homework-submission">
<h1>Homework Submission<a class="headerlink" href="#homework-submission" title="Permalink to this headline">#</a></h1>
<!-- ```{include} ../common/aws_caution.md
``` -->
<p>Your writeup should follow <a class="reference internal" href="../writeup_guidelines.html"><span class="doc std std-doc">the writeup guidelines</span></a>.
Your writeup should include your answers to the following questions:</p>
<style type="text/css">
    ol { list-style-type: decimal; }
    ol ol { list-style-type: lower-alpha; }
    ol ol ol { list-style-type: lower-roman; }
    table { width: 100%; }
    td {height:50px;text-align: center;}
    tr:nth-child(even) {background-color: #f2f2f2;}
</style>
<ol>
<li><p><strong>Initial CPU implementation and HLS Kernel</strong></p>
<ol>
<li><p>You must have the old SD card image you used for HW3/HW4. Just like we did in HW3/HW4, boot the Ultra96,
connect your local machine and the Ultra96, and then copy files in unders the <code class="docutils literal notranslate"><span class="pre">hw5/hls/</span></code> to your Ultra96.
Find the latency of the matrix multiplier (mmult kernel) using <code class="docutils literal notranslate"><span class="pre">stopwatch</span></code> class in
<code class="docutils literal notranslate"><span class="pre">hw5/hls/Testbench.cpp</span></code>. Use <code class="docutils literal notranslate"><span class="pre">-O3</span></code> and report it in ms. This is our baseline. (1 line)</p></li>
<li><p>Now move to Detkin/Ketter Linux machine(or your local machine if you installed Vitis).
We will now simulate the matrix multiplier in Vitis HLS.</p>
<ul>
<li><p>First, cd to the HW5 directory that you git cloned, and source settings to be able to run vitis_hls.
<code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">sourceMe.sh</span></code>.</p>
<p><strong>If you work locally</strong>, source <code class="docutils literal notranslate"><span class="pre">settings64.sh</span></code> in vitis installation directory.</p>
<p>(e.g.: <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/tools/Xilinx/Vitis/2020.2/settings64.sh</span></code>)</p>
<p>You can add line like this above the <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">LM_LICENSE_FILE=...</span></code> line in <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>.</p>
</li>
<li><p>Start Vitis HLS by <code class="docutils literal notranslate"><span class="pre">vitis_hls</span> <span class="pre">&amp;</span></code> in the terminal. You should now see the IDE.</p></li>
<li><p>Create a new project and add <code class="docutils literal notranslate"><span class="pre">hw5/hls/MatrixMultiplication.cpp</span></code> and <code class="docutils literal notranslate"><span class="pre">hw5/hls/MatrixMultiplication.h</span></code> as source files.</p></li>
<li><p>Specify <code class="docutils literal notranslate"><span class="pre">mmult</span></code> as top function.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">hw5/hls/Testbench.cpp</span></code> as TestBench files.</p></li>
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">xczu3eg-sbva484-1-i</span></code> in the device
selection. Use a <em><strong>150MHz</strong></em>
clock, and select <em><strong>Vitis Kernel Flow Target</strong></em> for the Flow Target.
Click Finish.</p></li>
<li><p>Right-click on <em><strong>solution1</strong></em> and select
<em><strong>Solution Settings</strong></em>.</p></li>
<li><p>In the <em><strong>General</strong></em> tab, select <em><strong>config_compile</strong></em> command and set
<em><strong>pipeline_loops</strong></em> to <em><strong>0</strong></em>. Vitis HLS automatically does loop pipelining. For the purpose of this homework, we will turn it off,
since we are going to do it ourselves.</p></li>
<li><p><em><strong>Run C simulation</strong></em> by right-clicking on the project on the <em><strong>Explorer</strong></em> view, and verify that the test
passes in the console.  Include the console output in your
report.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We set the clock as 150MHz(6.7ns), but you can increase/decrease the clock.
The target clock you set in HLS is just a target, but it provides optimization and feedback.</p>
</div>
</li>
<li><p>Look at the testbench.  How does the testbench
verify that the code is correct? (3 lines)
(We provide you a testbench here.  As you develop your own
components for the project, you will need to develop your own
testbenches.  Our testbenches can serve as an example and
template for you.)</p></li>
<li><p>Synthesize the matrix multiplier in Vitis HLS.
Analyze the <em><strong>Synthesis Report</strong></em> by expanding the <em><strong>solution1</strong></em> tab in the <em><strong>Explorer</strong></em> view, browsing to <em><strong>syn/report</strong></em> and opening the <code class="docutils literal notranslate"><span class="pre">.rpt</span></code> file.
What is the expected latency of the hardware accelerator in ms? (1 line)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is “High Level” synthesis. This is the process of translating your C source code to RTL.
Logic synthesis that transforms RTL-specified design into a gate-level representation
is done on Vivado. Note that the numbers you got from 1-d,e are all estimates!</p>
</div>
</li>
<li><p>How many resources of each type (BlockRAM, DSP unit, flip-flop,
and LUT) does the implementation consume? (4 lines)</p></li>
<li><p>Analyze how the computations are scheduled in time.  You can
see this information in the <em><strong>Schedule Viewer</strong></em> of the
<em><strong>Analysis</strong></em> perspective.  How many cycles does a
multiplication take? (1 line)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the <em><strong>Schedule Viewer</strong></em>, you will see <em><strong>Operation\Control Step</strong></em>.
Scroll down to the loop you are interested in and click the operation to view the schedule of the operation.</p>
</div>
</li>
<li><p>Make a schematic drawing of the hardware implementation
consisting of the data path and state machine similar to Figure 2
of the <a class="reference external" href="https://www.xilinx.com/support/documentation/sw_manuals/xilinx2020_1/ug1399-vitis-hls.pdf#page=9">Vitis HLS User Guide</a>.
You can ignore the addressing and loop hardware (such as
<code class="docutils literal notranslate"><span class="pre">phi_mux</span></code> and <code class="docutils literal notranslate"><span class="pre">icmp</span></code>) in your data path.</p></li>
<li><p>Explain why the performance of this accelerator is
worse than the software implementation. (3 lines)</p></li>
</ol>
</li>
<li><p><strong>HLS Kernel Optimization: Loop Unrolling</strong></p>
<ol>
<li><p>Go back to the <em><strong>Synthesis perspective</strong></em>, and unroll the
loop with label <code class="docutils literal notranslate"><span class="pre">Main_loop_k</span></code> 2 times using an <code class="docutils literal notranslate"><span class="pre">unroll</span></code>
pragma (See <a class="reference external" href="https://docs.xilinx.com/r/2020.2-English/ug1399-vitis-hls/pragma-HLS-unroll">this</a> for an example of unroll pragma). Synthesize the code and look again at the schedule.
Does the latency of the entire loop change? Explain the latency discrepancy from the original (non-unrolled).</p>
 <!-- Explain how the schedule for the unrolled loop is able to
 reduce the latency of the entire loop evaluation (all
 iterations) compared to the original (non-unrolled)
 loop.  (3-4 lines). -->
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>What characteristic of the original code prevented
this optimization? and why is the unrolled loop able to exploit
more parallelism?</p>
</div>
</li>
<li><p>We could also have unrolled the loop manually.
What would the
equivalent C code look like?</p></li>
<li><p>Inspect the resource usage in the <em><strong>Resource Profile</strong></em>
view of the <em><strong>Analysis</strong></em> perspective, as we increase the unroll factor. Of the
computational resources (<code class="docutils literal notranslate"><span class="pre">fmul</span></code> and <code class="docutils literal notranslate"><span class="pre">fadd</span></code>)
which one(s) are shared by  multiple operations? (1 line)</p></li>
<li><p>Unroll the loop with label <code class="docutils literal notranslate"><span class="pre">Main_loop_k</span></code>
completely, and
synthesize the design again. You may notice that the estimated clock period in the <em><strong>Synthesis perspective</strong></em> is shown in red.
What does this mean? (3 lines)</p>
 <!-- ```{note}
     Due to
     variation among Vitis HLS versions, sometimes it works and
     nothing is flagged.  The intent of this question is to
     illustrate things you may encounter and (with the following
     questions) show you how to address them.  If it's not
     flagged in red, just report the estimated clock period.
 ``` -->
</li>
<li><p>Change the clock to <em><strong>100MHz</strong></em>, and
synthesize it again. What is the expected latency of the new accelerator in ms? (1 line)</p></li>
<li><p>How many resources of each type (BlockRAM, DSP unit, flip-flop,
and LUT) does this implementation consume? (4 lines)</p></li>
<li><p>You may have noticed that all floating-point additions are
scheduled in series.  What does this imply about floating-point
additions? (2 lines)</p></li>
<li><p>We want to multiply two streams of matrices with each other.  We
can fill the FPGA with copies of one of the accelerators from question
1d(original, 150MHz) or 2e(unrolled, 100MHz).  Which
accelerator would you choose for the highest throughput?</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>We are just asking for a Resource Bound analysis here.
How many copies of the each design can you fit in the resources available in Ultra96’s logic? What throughput does each design achieve?</p>
</div>
</li>
</ol>
</li>
<li><p><strong>HLS Kernel Optimization: Pipelining</strong></p>
<ol>
<li><p>Remove the unroll pragma, and pipeline the <code class="docutils literal notranslate"><span class="pre">Main_loop_j</span></code>
loop with the minimal initiation
interval (II) of 1 using the <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> pragma. Restore the clock to <em><strong>150MHz</strong></em>.
Synthesize the design again.  Report the
initiation interval for the <code class="docutils literal notranslate"><span class="pre">Main_loop_j</span></code> that the design achieved. (1 line)
<!-- (You may find the timing is
     still not met. It does not matter, we will fix it later.)  --></p></li>
<li><p>Draw a schematic for the data path of <code class="docutils literal notranslate"><span class="pre">Main_loop_j</span></code>
and show how it is connected to the memories.  You can find the
variables that are mapped onto memories in the <em><strong>Resource Profile</strong></em> view of the
<em><strong>Analysis</strong></em> perspective.</p></li>
<li><p>Assuming a continuous flow of input data, how many data
does the pipelined loop need per clock cycle from <code class="docutils literal notranslate"><span class="pre">Buffer_1</span></code>?
(1 line)</p></li>
<li><p>Considering what you found in the two previous questions, why does
the tool not achieve an initiation interval of 1? (3 lines)</p></li>
<li><p>We can partition <code class="docutils literal notranslate"><span class="pre">Buffer_1</span></code> and <code class="docutils literal notranslate"><span class="pre">Buffer_2</span></code> to
achieve a better performance.  Illustrate the best way to partition
each of the arrays with a picture that shows how the elements of
these arrays are accessed by one iteration of the pipelined loop.</p></li>
<li><p>Partition the buffers according to your description in the
previous question with the <code class="docutils literal notranslate"><span class="pre">array_partition</span></code> pragma. (See <em><strong>Partitioning Arrays to Improve Pipelining</strong></em> <a class="reference external" href="https://docs.xilinx.com/r/2020.2-English/ug1399-vitis-hls/pragma-HLS-array_partition">Section of the Vitis HLS User Guide</a>
for examples of array partitioning pragma).
Also, pipeline the <code class="docutils literal notranslate"><span class="pre">Init_loop_j</span></code> loop.
Synthesize the design and report the expected latency in ms. Provide the modified <code class="docutils literal notranslate"><span class="pre">mmult</span></code> code in your report.</p></li>
<li><p>How many resources of each type (BlockRAM, DSP unit, flip-flop,
and LUT) does this implementation consume? (4 lines)</p></li>
<li><p>Pipeline the <code class="docutils literal notranslate"><span class="pre">Init_loop_j</span></code> loop also with an II of
1 and synthesize your design. Before exporting the synthesized design, you can run C/RTL co-simulation to verify
that the RTL is functionally identical to the C code.</p></li>
<li><p>Export your synthesized design by right-clicking on <em><strong>solution1</strong></em> and then selecting <em><strong>Export RTL</strong></em>. Choose <em><strong>Vitis Kernel (.xo)</strong></em> as the
<em><strong>Format</strong></em>. Select output location to be your
<code class="docutils literal notranslate"><span class="pre">ese532_code/hw5</span></code> directory and select OK.
Save your design and quit Vitis HLS. Open a terminal and go to your <code class="docutils literal notranslate"><span class="pre">ese532_code/hw5</span></code> directory.
Run by following the instruction in <a class="reference internal" href="walk_through.html#vitis"><span class="std std-ref">Building the code</span></a> section.</p>
 <!--         Commit the Vitis Analyzer files in your repo. We will use it in the next section. -->
</li>
</ol>
</li>
<li><p><strong>Vitis Analyzer</strong></p>
<p>We will now use Vitis Analyzer to analyze the trace of our matrix multiplication on the FPGA.</p>
 <!-- ```{note}
 Note that the only way to view the Vitis Analyzer is using the GUI.
 So collaborate with your partner if you are not able to use the GUI
 or try to [install Vitis toolchain locally](https://github.com/Xilinx/Vitis-In-Depth-Tutorial/blob/master/Getting_Started/Vitis/Part2.md#vitis-flow-101--part-2--installation-guide).
 ``` -->
<ol>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span> <span class="pre">./mmult.xclbin.run_summary</span></code> to open Vitis Analyzer.</p></li>
<li><p>Find the latency of the matrix multiplication (mmult kernel) by hovering on the kernel call in the application timeline.</p></li>
<li><p>Take a screenshot of the <em><strong>Application Timeline</strong></em>. Try to zoom into the relevant section and have everything in one screenshot. Figure out which lines from <code class="docutils literal notranslate"><span class="pre">Host.cpp</span></code> correspond to the sections in the screenshot and annotate the screenshot. Include the annotated screenshot in your report. If you can’t fit everything in one screenshot, take multiple screenshots and annotate. For your reference, following is an example screenshot.
Keep the trace in Vitis Analyzer open, we will use the numbers from it in the next section.</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/vitis_analyzer.png"><img alt="../_images/vitis_analyzer.png" src="../_images/vitis_analyzer.png" style="height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Example screenshot</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</li>
</ol>
</li>
<li><p><strong>Breakeven and Net Acceleration</strong></p>
<p>We can model an accelerator with setup and transfer time as:</p>
<div class="math notranslate nohighlight" id="equation-accelerator-model">
<span class="eqno">(2)<a class="headerlink" href="#equation-accelerator-model" title="Permalink to this equation">#</a></span>\[T_{accel} = T_{setup}+T_{transfer}+T_{fpga}\]</div>
<p>Let <span class="math notranslate nohighlight">\(T_{seq}\)</span> be the time for an operation (such as the matrix multiply) on the ARM that your found in 1a
and <span class="math notranslate nohighlight">\(T_{fpga}\)</span> be the time for the operation on the FPGA that you found in 4b.</p>
<p>Let <span class="math notranslate nohighlight">\(S_{fpga}=\frac{T_{seq}}{T_{fpga}}\)</span> or <span class="math notranslate nohighlight">\(T_{fpga}=\frac{T_{seq}}{S_{fpga}}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(T_{setup}\)</span> is the time to setup the operation and <span class="math notranslate nohighlight">\(T_{transfer}\)</span> is the time to move the data for the operation to the FPGA and back.
Include all operations like “create context”, “create program with binary”, etc in <span class="math notranslate nohighlight">\(T_{setup}\)</span>.</p>
<ol>
<li><p>What is <span class="math notranslate nohighlight">\(S_{fpga}\)</span> for the matrix-multiply operation above?</p></li>
<li><p>Find <span class="math notranslate nohighlight">\(T_{setup}\)</span> using the trace in 4c.</p></li>
<li><p>Find <span class="math notranslate nohighlight">\(T_{transfer}\)</span> using the trace in 4c.</p></li>
<li><p>Using <span class="math notranslate nohighlight">\(S_{fpga}\)</span>, <span class="math notranslate nohighlight">\(T_{setup}\)</span>, and <span class="math notranslate nohighlight">\(T_{transfer}\)</span> from the above, how
large would <span class="math notranslate nohighlight">\(T_{seq}\)</span> need to be to get an actual overall speedup?</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Solve for <span class="math notranslate nohighlight">\(T_{seq}\)</span> in:</p>
<div class="math notranslate nohighlight">
\[\frac{T_{seq}}{T_{accel}} &gt; 1\]</div>
</div>
</li>
<li><p>How does <span class="math notranslate nohighlight">\(T_{seq}\)</span> scale with the matrix dimension <span class="math notranslate nohighlight">\(N\)</span>? (write an
equation for <span class="math notranslate nohighlight">\(T_{seq}\)</span> as a function of <span class="math notranslate nohighlight">\(N\)</span>).</p></li>
<li><p>How does <span class="math notranslate nohighlight">\(T_{fpga}\)</span> scale with the matrix dimension <span class="math notranslate nohighlight">\(N\)</span>? (write an
equation for <span class="math notranslate nohighlight">\(T_{fpga}\)</span> as a function of <span class="math notranslate nohighlight">\(N\)</span>) for your fully unrolled
loop strategy from Problem 3 (<code class="docutils literal notranslate"><span class="pre">Main_loop_j</span></code> pipelined, <code class="docutils literal notranslate"><span class="pre">Main_loop_k</span></code> unrolled).</p></li>
<li><p>How does <span class="math notranslate nohighlight">\(T_{transfer}\)</span> scale with the matrix dimension <span class="math notranslate nohighlight">\(N\)</span>? (write an
equation for <span class="math notranslate nohighlight">\(T_{transfer}\)</span> as a function of <span class="math notranslate nohighlight">\(N\)</span>).</p></li>
<li><p>Based on 5e, 5f, 5g, for what value of <span class="math notranslate nohighlight">\(N\)</span> would <span class="math notranslate nohighlight">\(T_{accel}\)</span> be equal to the value of <span class="math notranslate nohighlight">\(T_{seq}\)</span>?</p></li>
<li><p>Based on the above, for what value of <span class="math notranslate nohighlight">\(N\)</span> would <span class="math notranslate nohighlight">\(T_{accel}=\frac{T_{seq}}{10}\)</span>, i.e. what value of <span class="math notranslate nohighlight">\(N\)</span> would show a 10x speedup?</p></li>
<li><p>For the value of <span class="math notranslate nohighlight">\(N\)</span> found in 5i, what is the value of <span class="math notranslate nohighlight">\(S_{fpga}\)</span>?</p></li>
<li><p>If you perform a large number of accelerator invocations, you only need to perform the setup operations once.</p>
<div class="math notranslate nohighlight" id="equation-accelerator-model-k-invoke">
<span class="eqno">(3)<a class="headerlink" href="#equation-accelerator-model-k-invoke" title="Permalink to this equation">#</a></span>\[T_{accel} = T_{setup}+k \cdot (T_{transfer}+T_{fpga})\]</div>
<p>Assuming the number of invocations, <span class="math notranslate nohighlight">\(k\)</span>, is large (say 1 million), how does
this change the value of N for 10x speedup (
<span class="math notranslate nohighlight">\(T_{accel}=\frac{T_{seq}}{10}\)</span>) ?</p>
</li>
</ol>
</li>
<li><p><strong>Reflection</strong></p>
<ol>
<li><p>Problems 1–3 in this assignment took you through
a specific optimization sequence for this task.
Describe the optimization sequence in terms
of identification and reduction of bottlenecks. (4 lines)</p></li>
<li><p>Make an area-time plot for the three designs with
a curve for DSPs and BlockRAMs.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Expected latency (ms) on X-axis, DSPs and BlockRAMs as separate curves on the Y-axis.</p>
</div>
</li>
</ol>
</li>
</ol>
<!--     1. Go to your AWS Billing page and report the total
        amount of credit used so far (make sure to add up credit used from September). -->
<section id="deliverables">
<h2>Deliverables<a class="headerlink" href="#deliverables" title="Permalink to this headline">#</a></h2>
<p>In summary, upload the following in their respective links in canvas:</p>
<ul class="simple">
<li><p>writeup in pdf.</p></li>
</ul>
<!-- ```{include} ../common/aws_caution.md
``` -->
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./hw5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="walk_through.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Setup and Walk-through</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../hw6/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">HW6 – Accelerator Interface</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Department of Electrical and Systems Engineering<br/>
  
      &copy; Copyright 2022 Department of Electrical and Systems Engineering at the University of Pennsylvania.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>