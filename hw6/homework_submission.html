
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Homework Submission &#8212; ESE5320 Handouts Fall 2025</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'hw6/homework_submission';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HW7 – Restructuring C for Accelerator and Zynq Transition" href="../hw7/index.html" />
    <link rel="prev" title="Setup and Walk-through" href="walk_through.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/penn_engineering.png" class="logo__image only-light" alt="ESE5320 Handouts Fall 2025 - Home"/>
    <script>document.write(`<img src="../_static/penn_engineering.png" class="logo__image only-dark" alt="ESE5320 Handouts Fall 2025 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Overview
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://www.seas.upenn.edu/~ese5320/fall2025/fall2025.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writeup_guidelines.html">Writeup Guidelines</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Homework Assignments</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw0/index.html">Diagnostic Assessment</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw0/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw0/questions.html">Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw0/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw1/index.html">HW1 – Remember C</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw1/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/walk_through.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/makefile_tutorial.html">Makefile Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/gdb_tutorial.html">GDB Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/c_refresher.html">C Refresher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/debug_app.html">Debug an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw1/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw2/index.html">HW2 – Profiling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw2/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw2/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw2/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw3/index.html">HW3 – Thread Parallel</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw3/collaboration.html">Collaboration</a></li>

<li class="toctree-l2"><a class="reference internal" href="../hw3/u96v2_setup.html">Ultra96 Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw3/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw3/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw4/index.html">HW4 – SIMD</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw4/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw4/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw4/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw5/index.html">HW5 – Accelerator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw5/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw5/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw5/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">HW6 – Accelerator Interface</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Homework Submission</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hw7/index.html">HW7 – Restructuring C for Accelerator and Zynq Transition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hw7/collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw7/walk_through.html">Setup and Walk-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw7/homework_submission.html">Homework Submission</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/icgrp/ese532_handouts" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/icgrp/ese532_handouts/edit/master/ese532_handouts/hw6/homework_submission.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/icgrp/ese532_handouts/issues/new?title=Issue%20on%20page%20%2Fhw6/homework_submission.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/hw6/homework_submission.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Homework Submission</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">Deliverables</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="homework-submission">
<h1>Homework Submission<a class="headerlink" href="#homework-submission" title="Link to this heading">#</a></h1>
<p>Your writeup should follow <a class="reference internal" href="../writeup_guidelines.html"><span class="doc std std-doc">the writeup guidelines</span></a>.
Your writeup should include your answers to the questions below. Even if a certain
question(like 1-(c) or 1-(f)) is just a “step”, please include it in your report and leave the bullet blank
for the sake of easy grading.</p>
<style type="text/css">
    ol { list-style-type: decimal; }
    ol ol { list-style-type: lower-alpha; }
    ol ol ol { list-style-type: lower-roman; }
    table { width: 100%; }
    td {height:50px;text-align: center;}
    tr:nth-child(even) {background-color: #f2f2f2;}
</style>
<!-- 1. **Setup**

    ---
    - We have updated the platform to have contiguous memory support. Please
    remove the platform you downloaded in the hello world section and
    download the platform again from the following links:
        - [Ultra96 Platform](https://ese532-platforms.s3.amazonaws.com/hw6_platform_v2.tar.gz)
        - [Ultra96 Platform (Asia)](https://ese532-platforms-asia.s3.ap-northeast-2.amazonaws.com/hw6_platform_v2.tar.gz)
    - Extract the platform to a desired location.
    - Set the `PLATFORM_REPO_PATHS` to the extracted directory. For instance:
        ```
        export PLATFORM_REPO_PATHS=~/ese532_hw6_pfm
        ```
    - Get the source code from the `ese532_code` repository by pulling in the latest changes
    using:
        ```
        cd ese532_code/
        git pull origin master
        ```
        The code you will use for this section
        is in the `hw6` directory. The directory structure looks like this:
        ```
        hw6/
            apps/
                mmult/
                    cpu/
                        Host.cpp
                    fpga/
                        hls/
                            MMult.cpp
                            MMult.h
                            testbench.cpp
                        Host.cpp
                        design.cfg
                        package.cfg
                        xrt.ini
                    Makefile
                    compile_on_biglab.sh
            common/
                ...
        ```
    - cd into `hw6/apps/mmult/` directory.
    - Use `make cpu` to build the cpu baseline and run with `./mmult_cpu`.
    - Use `make fpga -j4` to start the Vitis build. This will take about 20-30 minutes and generate the `xclbin`. Note that we used `-j4` to build with 4
    cpus. If you have more cpus, you can increase this number.
    `-j16` is usually the maximum parallel jobs Vitis can handle.
    - Use `make host` to build the OpenCL host code. This produces the `package` folder.
    - Copy the files from `package` folder to the Ultra96, reboot and run on the fpga.
    - Use `make clean` to clean all the generated files.
        ```{warning}
        If you do `make clean`, you will lose all the files and the compilation will start from the beginning. You can incrementally build and clean as mentioned in the walk-through.
        ``` -->
<ol class="arabic">
<li><p><strong>Accelerator Interface</strong></p>
<ol class="arabic">
<li><p>Run CPU version on Ultra96, and report the latency.</p></li>
<li><p>For FPGA version, run the code,
copy the Vitis Analyzer files to your computer and open them with Vitis Analyzer.
Click <em><strong>Profile Summary</strong></em>, and then <em><strong>Summary</strong></em> to see
<em>Total application runtime</em> and <em>Total kernel runtime</em>.
Click <em><strong>Kernels &amp; Compute Units</strong></em> to see only the <em>kernel execution time</em>.
We will check these three latencies throughout this HW.
Report the latencies.</p>
  <!--```{note}
  There are two types of platforms: datacenter and embedded. 
  Ultra96, we are using in class, is an embedded platform.
  In `host.cpp`, many [examples](https://github.com/Xilinx/Vitis_Accel_Examples/blob/2020.2/host/data_transfer/src/host.cpp)
  on the web, targeting datacenter cards, use `aligned_allocator` to avoid warnings regarding *unaligned host pointer*.
  Note that we use `enqueueMapBuffer`, and this approach is portable accross both datacenter and embedded platforms,
  as explained in Step 2 of [this tutorial](https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis/Part3.md).
  ```
 1. In the previous step, you must have seen warnings regarding unaligned host pointer.
 You will now allocate contiguous host memories. 
 Take a look at Step 2 in [this tutorial](https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis/Part3.md).
 In `apps/mmult/fpga/HostAligned.cpp`, we kindly provide three TODOs for this step.
     ```{hint}
     As shown in the example link, you should only use the following flags when allocating memory 
     using cl::Buffer: CL_MEM_READ_ONLY, CL_MEM_WRITE_ONLY, CL_MEM_READ_ONLY | CL_MEM_WRITE_ONLY. 
     All other flag usage prevents contiguous memory allocation or behaves non-deterministically on the Ultra96 
     (i.e. when using CL_MEM_USE_HOST_PTR).
     ```
 1. Build the project with the modified host code. Because only the host code is modified,
 it should take less than a minute to complete.
 Copy only neccessary files and report the three latencies in the Vitis Analyzer. -->
</li>
<li><p>In the Vitis Analyzer, open the application timeline. Zoom in at the beginning of the kernel execution, and
provide a screenshot in the write up.
Based on the analyzer, suggest at least two ways of improving the performance of the FPGA code.</p>
 <!-- 1. How does the code in `Host.cpp` preserve dependencies between computations?
<ol class="arabic">
<li><p>We will now investigate why we still don’t see communication-compute overlap.</p>
<ul>
<li><p>In terminal, make sure you correctly sourced the settings, and open Vitis HLS, with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_hls</span>
</pre></div>
</div>
</li>
<li><p>Click on <em><strong>open project</strong></em> and browse to the your build generated directory: <code class="docutils literal notranslate"><span class="pre">hw6/apps/mmult/_x/kernel/mmult_fpga/mmult_fpga</span></code>
and click open.</p></li>
<li><p>From the <em><strong>Explorer</strong></em> tab, open <em><strong>solution</strong></em><span class="math notranslate nohighlight">\(\rightarrow\)</span><em><strong>syn</strong></em><span class="math notranslate nohighlight">\(\rightarrow\)</span><em><strong>report</strong></em><span class="math notranslate nohighlight">\(\rightarrow\)</span><em><strong>mmult_fpga_csynth.rpt</strong></em>.</p></li>
<li><p>Browse to the <em><strong>Interface</strong></em> section and examine
the interface that was generated. Describe how the host processor communicates with the generated interface of the accelerator. –&gt;</p></li>
</ul>
</li>
</ol>
 <!-- 1. What needs to happen to the HLS code so that we can achieve task-level parallelism?
     ```{hint}
     Look at Figure 18: Host to Kernel Dataflow
     of [UG1393](https://www.xilinx.com/support/documentation/sw_manuals/xilinx2020_2/ug1393-vitis-application-acceleration.pdf#page=78)
     ``` -->
</li>
<li><p>We will now modify the kernel code.</p>
<ul>
<li><p>In terminal, make sure you correctly sourced the settings, and open Vitis HLS, with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_hls</span>
</pre></div>
</div>
</li>
<li><p>Click on <em><strong>open project</strong></em> and browse to the your build generated directory: <code class="docutils literal notranslate"><span class="pre">hw6/apps/mmult/_x/kernel/mmult_fpga/mmult_fpga</span></code>
and click open.</p></li>
</ul>
</li>
<li><p>Partition the HLS code into Load-Compute-Store Pattern as can be seen in <a class="reference external" href="https://github.com/Xilinx/Vitis_Accel_Examples/tree/2021.1/cpp_kernels/dataflow_stream">this example</a>
and <a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/2020.2/Getting_Started/Vitis_HLS/dataflow_design.md">this tutorial</a>.
Enable dataflow with <code class="docutils literal notranslate"><span class="pre">HLS</span> <span class="pre">DATAFLOW</span></code> pragma and use <code class="docutils literal notranslate"><span class="pre">hls::stream</span></code>
to pass data between Load, Compute, Store functions. Make additional changes to the code to achieve II=1.</p></li>
<li><p>Make sure to run C simulation and verify that your HLS code is functionally correct. Provide the code in your report.
Also, provide the screenshot of <em><strong>Performance &amp; Resource Estimates</strong></em> table in
the Synthesis Summary Report. Because you have Load, Compute, Store functions,
expand each function in the table to show that you achieved II=1.</p></li>
<li><p>Rebuild the project with the dataflow-enabled kernel, copy the binaries and boot files, reboot and test.
This will take about 30 minutes to build. Report the latencies. Provide a screenshot of the relevant section of Application Trace from Vitis Analyzer.</p></li>
<li><p>Our initial FPGA host code uses an in-order command queue.
Find out how to use an out-of-order command queue
to get <a class="reference external" href="https://docs.amd.com/r/2024.1-English/ug1393-vitis-application-acceleration/Overlapping-Data-Transfers-with-Kernel-Computation">overlap between communication and computation</a>.
Make the necessary change in the <code class="docutils literal notranslate"><span class="pre">Host.cpp</span></code> and provide the change in the report.
Build the project with the modified host code. Report the three latencies. Provide a screenshot from Vitis Analyzer.
We expect you to see something like <a class="reference internal" href="#comp-comm-overlap"><span class="std std-numref">Fig. 20</span></a> or <a class="reference internal" href="#comp-comm-overlap-2"><span class="std std-numref">Fig. 21</span></a>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<ul class="simple">
<li><p>Read the overlap between communication and computation document and specifically look at the <strong>Figure: Event Triggering Setup</strong>. Your goal is to create a design such that you can achieve this out of order queue for data movement.</p></li>
</ul>
</div>
<figure class="align-default" id="comp-comm-overlap">
<img alt="../_images/comp_comm_overlap.png" src="../_images/comp_comm_overlap.png" />
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Communication and Computation overlap</span><a class="headerlink" href="#comp-comm-overlap" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="comp-comm-overlap-2">
<img alt="../_images/comp_comm_overlap_2.png" src="../_images/comp_comm_overlap_2.png" />
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Communication and Computation overlap when a kernel runtime is longer</span><a class="headerlink" href="#comp-comm-overlap-2" title="Link to this image">#</a></p>
</figcaption>
</figure>
</li>
<li><p>Use the following command in your host machine. Report the clocks, memory ports and resources that are available on the platform:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>platforminfo $PLATFORM_REPO_PATHS/u96v2_sbc_base.xpfm
</pre></div>
</div>
</li>
<li><p>Assign separate ports to the <code class="docutils literal notranslate"><span class="pre">mmult_fpga</span></code>, then rebuild and run the kernel.
This will take about 30 minutes to build. Report the latencies. Provide a screenshot of the relevant section of Application Trace from Vitis Analyzer. (Including System Diagram)
Does assigning multiple ports on Ultra96 have any impact on your design?
Save/Move the <code class="docutils literal notranslate"><span class="pre">hw6/apps/mmult/_x</span></code> folder of the project to somewhere else before doing the next question.
We will use the outputs from this question in the next part.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<ul class="simple">
<li><p>Learn about how to add multiple ports from <a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/docs/Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.html">here</a></p></li>
<li><p>Under hw6/apps/mmult/fpga there is a file called design.cfg. In that file you will need to add the commands to map the kernel arguments to the ports under the <code class="docutils literal notranslate"><span class="pre">[connectivity]</span></code> section. You can find the commands in the tutorial linked above. You can use the memory ports available from part i. There is no need to create a separate connectivity.cfg file and modify the Makefile.</p></li>
<li><p>Read this <a class="reference external" href="https://ieeexplore.ieee.org/document/8977835/">paper</a> to find out how to efficiently use the ports on Ultra96 (optional).</p></li>
</ul>
</div>
</li>
<li><p>Learn about how to use multiple compute units from
<a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/docs/Runtime_and_System_Optimization/Feature_Tutorials/02-using-multiple-cu/README.html">here</a>
and apply it to your design. Note that you need to modify your host code to get multiple compute units working.
Use 2 <code class="docutils literal notranslate"><span class="pre">mmult_fpga</span></code> units. This can be done by modifying <code class="docutils literal notranslate"><span class="pre">design.cfg</span></code>.<br />
Rebuild the FPGA version,
copy the binaries and boot files, reboot and test. This will take about &gt;30 minutes to build. Report the latencies.
Provide a screenshot of the relevant section of Application Trace from Vitis Analyzer. (Including System Diagram)</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<ul class="simple">
<li><p>You may need to reduce the number of NUM_MAT and/or the size of your array partition from 2.1</p></li>
</ul>
</div>
</li>
<li><p>Put your latency results from the CPU version in part a, and your FPGA implementations in parts b, g, j, and k into a table, and show the speedup relative to the CPU version.</p></li>
</ol>
</li>
<li><p><strong>Analyze Implementation</strong></p>
<p>In this question, we will investigate what the FPGA implementation
of the matrix multiplication (Part 1.11) look like using Vivado (not
Vivado HLS).  Vivado is part of the Vitis installation.</p>
<ol class="arabic">
<li><p>Report how many resources and utilization percentage of each type (BlockRAM, DSP unit,
flip-flop, and LUT) the implementation (Part 1.11)
consumes. You can find this information in the <em><strong>Implementation</strong></em> tab on the
left hand side. Click <em><strong>Report Utilization</strong></em> under <em><strong>Open Implemented Design</strong></em>.
Launch Vivado using the following commands and open the
project you saved/moved from the location <code class="docutils literal notranslate"><span class="pre">hw6/apps/mmult/_x/link/vivado/vpl/prj/prj.xpr</span></code>. (4 lines)</p>
<ul>
<li><p>In terminal, make sure you correctly sourced the settings, and open Vivado, with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vivado</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Report the expected power consumption of this design by clicking <em><strong>Report Power</strong></em> of the <em><strong>Implementation</strong></em> tab. (1 line)</p></li>
<li><p>On the left top corner, you will see <em><strong>IP Integrator</strong></em>. Click <em><strong>Open Block Design</strong></em> under
<em><strong>IP Integrator</strong></em>.  Open the <em><strong>Address Editor</strong></em> by choosing the corresponding
tab above the block design.  In which memory region is the control interface of the
accelerator wrapper <code class="docutils literal notranslate"><span class="pre">mmult_fpga_1</span></code> mapped?  This region
is used for such communication as starting the accelerator and
querying its status.  Writes and reads by the ARM processor are to
this region are sent over an AXI4-Lite bus to the accelerator
wrapper, which handles them and controls the accelerator. (1 line)</p></li>
<li><p>Open the timing report by going to the <em><strong>Implementation</strong></em> tab and pressing <em><strong>Design Timing Summary</strong></em> from the <em><strong>Timing</strong></em> tab.  Click on
the number next to <a class="reference external" href="http://www.vlsi-expert.com/2011/03/static-timing-analysis-sta-basic-timing.html">Worst Negative Slack</a>.
Look at the
<code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">Properties</span></code>.  Report in which of the hardware modules that we
saw in the block design the path begins and ends. (1 line)</p></li>
<li><p>Include a screenshot of the critical path in your writeup.
Zoom in to make sure all elements of the path are clearly visible.
Indicate the type of each element (e.g. LUT, flip-flop,
carry chain) on the screenshot.</p></li>
<li><p>Highlight the accelerators in green, the interconnect (<code class="docutils literal notranslate"><span class="pre">M_AXI</span></code> and <code class="docutils literal notranslate"><span class="pre">S_AXI</span></code>) in yellow.  You can do this by right-
clicking the modules in the Netlist view and selecting
<em><strong>Highlight Leaf Cells</strong></em>.  Include a screenshot of the entire
device in your report.</p></li>
</ol>
</li>
</ol>
<section id="deliverables">
<h2>Deliverables<a class="headerlink" href="#deliverables" title="Link to this heading">#</a></h2>
<p>In summary, upload the following in their respective links in canvas:</p>
<ul>
<li><p>writeup in pdf.</p></li>
<li><p>a tarball containing the hw6 source code with your modified code.</p>
<div class="dropdown tip admonition">
<p class="admonition-title">Quick linux commands for tar files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compress</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">cvzf</span> <span class="o">&lt;</span><span class="n">file_name</span><span class="o">.</span><span class="n">tgz</span><span class="o">&gt;</span> <span class="n">directory_to_compress</span><span class="o">/</span>
<span class="c1"># Decompress</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvzf</span> <span class="o">&lt;</span><span class="n">file_name</span><span class="o">.</span><span class="n">tgz</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</li>
<li><p>writeup in pdf.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./hw6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="walk_through.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Setup and Walk-through</p>
      </div>
    </a>
    <a class="right-next"
       href="../hw7/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">HW7 – Restructuring C for Accelerator and Zynq Transition</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">Deliverables</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Department of Electrical and Systems Engineering
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025 Department of Electrical and Systems Engineering at the University of Pennsylvania.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>